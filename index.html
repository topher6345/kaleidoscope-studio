<html>
  <head>
    <title>CANVAS KALEIDOSCOPE DEMO</title>
    <script type="text/javascript">
      var imgLoaded = false;
      var ctx, img;

      /* ---------------------------------------------
     Loads a new kaleidoscope (Code and idea from http://www.experiencebureau.com/toys/kaleidoscope/ )
     ------------------------------------------------*/
      function loadNewKaleidoscope() {
        var canvas = document.getElementById("canvas");
        window.ctx = canvas.getContext("2d");
        window.img = document.getElementById("im");
        // document.onmousemove = onDocMouseMove;
        drawKaleidoscope(window.ctx, window.img, 0, 0);
      }

      /* ---------------------------------------------
     Draws a kaleidoscope (Code and idea from http://www.experiencebureau.com/toys/kaleidoscope/ )
     ------------------------------------------------*/
      function drawKaleidoscope(ctx, img, imgX, imgY) {
        try {
          var sqSide = 250;
          var sqDiag = Math.sqrt(2 * sqSide * sqSide);
          var maskSide = 500;
          if (img.height < img.width) {
            maskSide = Math.abs(img.height - sqDiag);
          } else {
            maskSide = Math.abs(img.width - sqDiag);
          }
          var c = 250;
          ctx.clearRect(0, 0, 500, 500);
          //7 (1)
          ctx.save();
          ctx.translate(c, c);
          ctx.rotate(-90 * (Math.PI / 180));
          ctx.scale(-1, -1);
          ctx.drawImage(
            img,
            imgX,
            imgY,
            maskSide,
            maskSide,
            0,
            0,
            sqSide,
            sqSide
          );
          ctx.restore();
          //2 (4)
          ctx.save();
          ctx.translate(c, c);
          ctx.rotate(-90 * (Math.PI / 180));
          ctx.scale(1, -1);
          ctx.drawImage(
            img,
            imgX,
            imgY,
            maskSide,
            maskSide,
            0,
            0,
            sqSide,
            sqSide
          );
          ctx.restore();
          //3 (5)
          ctx.save();
          ctx.translate(c, c);
          ctx.rotate(-90 * (Math.PI / 180));
          ctx.scale(1, 1);
          ctx.drawImage(
            img,
            imgX,
            imgY,
            maskSide,
            maskSide,
            0,
            0,
            sqSide,
            sqSide
          );
          ctx.restore();
          //8
          ctx.save();
          ctx.translate(c, c);
          ctx.rotate(-90 * (Math.PI / 180));
          ctx.scale(-1, 1);
          ctx.drawImage(
            img,
            imgX,
            imgY,
            maskSide,
            maskSide,
            0,
            0,
            sqSide,
            sqSide
          );
          ctx.restore();
          //1
          ctx.save();
          ctx.moveTo(c, c);
          ctx.lineTo(c - sqSide, c);
          ctx.lineTo(c - sqSide, c - sqSide);
          ctx.lineTo(c, c);
          ctx.clip();
          ctx.translate(c, c);
          ctx.scale(-1, -1);
          ctx.drawImage(
            img,
            imgX,
            imgY,
            maskSide,
            maskSide,
            0,
            0,
            sqSide,
            sqSide
          );
          ctx.restore();
          //4
          ctx.save();
          ctx.moveTo(c, c);
          ctx.lineTo(c + sqSide, c - sqSide);
          ctx.lineTo(c + sqSide, c);
          ctx.lineTo(c, c);
          ctx.clip();
          ctx.translate(c, c);
          ctx.scale(1, -1);
          ctx.drawImage(
            img,
            imgX,
            imgY,
            maskSide,
            maskSide,
            0,
            0,
            sqSide,
            sqSide
          );
          ctx.restore();
          //5
          ctx.save();
          ctx.moveTo(c, c);
          ctx.lineTo(c + sqSide, c);
          ctx.lineTo(c + sqSide, c + sqSide);
          ctx.lineTo(c, c);
          ctx.clip();
          ctx.translate(c, c);
          ctx.scale(1, 1);
          ctx.drawImage(
            img,
            imgX,
            imgY,
            maskSide,
            maskSide,
            0,
            0,
            sqSide,
            sqSide
          );
          ctx.restore();
          //8
          ctx.save();
          ctx.moveTo(c, c);
          ctx.lineTo(c - sqSide, c + sqSide);
          ctx.lineTo(c - sqSide, c);
          ctx.lineTo(c, c);
          ctx.clip();
          ctx.translate(c, c);
          ctx.scale(-1, 1);
          ctx.drawImage(
            img,
            imgX,
            imgY,
            maskSide,
            maskSide,
            0,
            0,
            sqSide,
            sqSide
          );
          ctx.restore();
        } catch (err) {
          img = "";

          ctx.clearRect(0, 0, 500, 500);
        }
      }

      function onDocMouseMove(e) {
        var ev = e ? e : window.event;
        mouseX = ev.clientX - document.getElementById("canvas").offsetLeft;
        mouseY = ev.clientY - document.getElementById("canvas").offsetTop;
        drawKaleidoscope(window.ctx, window.img, mouseX / 2, mouseY / 2);
      }

      setInterval(() => {
        var x = Math.floor(Math.random() * 1000);
        var y = Math.floor(Math.random() * 1000);
        drawKaleidoscope(window.ctx, window.img, x / 2, y / 2);
      }, 1000);
    </script>
    <style>
      body {
        padding: 0;
        margin: 0;
      }
    </style>
  </head>
  <body onload="loadNewKaleidoscope();">
    <canvas id="canvas" width="500" height="500"></canvas>
    <img
      src="/assets/canva2342342e32s.png"
      style="display: none;"
      onclick="renderASCII()"
      id="im"
    />
  </body>
</html>
